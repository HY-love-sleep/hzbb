# 中化项目用户中心改造

## 1、多租户管理

### 1.要求

### 2.相关概念

1. 租户是一个概念， 创建租户时会有一个**默认用户**， 作为租户管理员，例如tenant；

   tenant创建用户时， 用户信息关联tenentId;

2. 超级管理员创建租户时能够选定**模块权限**；

3. 租户层面不需要和机构关联， 还是延续目前的逻辑， 由租户创建的用户关联机构；



### 3.改造点

1. 补齐目前用户中心table中缺失tenantId字段的表；
2. 新建租户时查看关联了哪些表；
3. 测试目前用户中心的架构是否满足需求【租户、用户、角色、机构】 





## 2、操作日志

### 1.要求

平台支持对所有操作日志进行展示与详情查看，能以操作时间、操作账号、操作类型、操作模块等要素进行检索。

### 2.改造点

1. 操作时间、操作账号、操作模块通过切面拦截Controller接口请求可以获取。操作类型需要接口添加功能说明注释，考虑在接口扫描时获取接口上的@ApiOperation注解信息，直接将接口功能扫描到接口表中；

2. 对于日志的记录、存储，需要和接口调用解耦， 以免影响接口响应时间、系统性能等；

   - 考虑在接口扫描时**异步入库**，使用@Ansy等， 不影响主线程的服务启动流程；

     扫描完成后， 将**接口-功能描述缓存**到redis中

   - 切面获取到接口调用信息，到入库， 采用事件监听机制，切面只关心发布事件，后续处理由事件监听器完成；

     监听器监听到事件时， 采用CompletableFuture进行服务编排以及异步处理， 先根据事件中的url查询相关的功能描述，then将组装好的操作日志信息进行入库；





## 3、认证安全

### 1.要求

平台支持提供登录安全设置，包括登录连续失败锁定用户、登录超时时间等；支持提供密码策略设置，包括密码最小长度、密码最大长度、特殊字符、大小写字母、密码复杂度等。

### 2.改造点

测试这些功能是否具备；